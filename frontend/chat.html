<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat - Realtime Chat App</title>
  <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body>
  <div id="app">
    <!-- Chat page -->
    <div class="chat-container">
      <div class="chat-header">
        <div class="user-info">
          Real Time Chat
        </div>
        <div class="header-actions">
          <div class="profile-card" id="profile-card">
            <div class="profile-avatar" id="profile-avatar">?</div>
            <div class="profile-meta">
              <p id="profile-name">ƒêang t·∫£i...</p>
              <span id="profile-email"></span>
            </div>
          </div>
          <button id="logout-btn" class="btn btn-secondary">ƒêƒÉng xu·∫•t</button>
        </div>
      </div>
      
      <div class="chat-body">
        <!-- Sidebar -->
        <div class="sidebar">
          <div class="search-box">
            <input type="text" id="search-input" placeholder="T√¨m ki·∫øm..." />
          </div>
          <div class="sidebar-header">
            <div class="sidebar-tabs">
              <button class="tab-btn active" data-tab="users">üë• Ng∆∞·ªùi d√πng</button>
              <button class="tab-btn" data-tab="groups">üë• Nh√≥m</button>
            </div>
          </div>
          <div id="users-list" class="users-list tab-content active">
            <!-- Users will be loaded here -->
          </div>
          <div id="groups-list" class="groups-list tab-content" style="display: none;">
            <!-- Groups will be loaded here -->
            <button id="create-group-btn" class="btn btn-primary btn-create-group">+ T·∫°o nh√≥m</button>
          </div>
        </div>

        <!-- Chat area -->
        <div class="chat-area">
          <div id="no-chat-selected" class="no-chat-selected">
            <p>Ch·ªçn m·ªôt ng∆∞·ªùi d√πng ho·∫∑c m·ªôt nh√≥m ƒë·ªÉ b·∫Øt ƒë·∫ßu chat</p>
          </div>

          <div id="chat-messages-container" class="chat-messages-container" style="display: none;">
            <div class="chat-messages-header">
              <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                <div id="chat-avatar" style="width: 40px; height: 40px; border-radius: 50%; background-color: #ddd; display: flex; align-items: center; justify-content: center; font-weight: bold; background-size: cover; background-position: center;">
                </div>
                <h3 id="chat-with-name" style="margin: 0;">
                  <span class="chat-name-text"></span>
                  <span class="chat-online-indicator" id="chat-online-indicator"></span>
                </h3>
              </div>
              <div style="display: flex; gap: 10px;">
                <button id="toggle-group-menu-btn" class="btn" style="display: none;" title="Menu nh√≥m">‚ãÆ</button>
              </div>
            </div>
            <div id="messages-list" class="messages-list">
              <!-- Messages will be loaded here -->
            </div>
            <div id="typing-indicator" class="typing-indicator" style="display: none;">
              <span class="typing-text"></span>
            </div>
            <div class="chat-input-container">
              <input type="text" id="message-input" placeholder="Nh·∫≠p tin nh·∫Øn..." />
              <button id="send-btn" class="btn btn-primary">G·ª≠i</button>
            </div>
          </div>

          <!-- Group Menu Panel -->
          <div id="group-menu-panel" class="group-menu-panel" style="display: none;">
            <div class="group-menu-header">
              <h3>Th√¥ng tin nh√≥m</h3>
              <button id="close-group-menu-btn" class="btn-close">√ó</button>
            </div>
            <div class="group-menu-content">
              <!-- Group Info Section -->
              <div class="menu-section">
                <h4>Th√¥ng tin nh√≥m</h4>
                <div id="group-info-display" class="group-info-display">
                  <p><strong>T√™n:</strong> <span id="menu-group-name">-</span></p>
                  <p><strong>M√¥ t·∫£:</strong> <span id="menu-group-desc">-</span></p>
                  <p><strong>Th√†nh vi√™n:</strong> <span id="menu-group-member-count">0</span></p>
                </div>
              </div>

              <!-- Member Actions (visible for everyone) -->
              <div class="menu-section" id="member-actions-section">
                <h4>H√†nh ƒë·ªông</h4>
                <button id="btn-add-member" class="menu-btn">‚ûï Th√™m th√†nh vi√™n</button>
                <button id="btn-delete-group" class="menu-btn danger">üëã R·ªùi nh√≥m</button>
              </div>

              <!-- Admin Actions -->
              <div class="menu-section" id="admin-actions-section" style="display: none;">
                <h4>Qu·∫£n l√Ω nh√≥m</h4>
                <button id="btn-edit-group-in-menu" class="menu-btn">‚úèÔ∏è S·ª≠a nh√≥m</button>
                <button id="btn-change-role" class="menu-btn">üîë Thay ƒë·ªïi quy·ªÅn</button>
              </div>

              <!-- Members List -->
              <div class="menu-section">
                <h4>Danh s√°ch th√†nh vi√™n</h4>
                <div id="group-members-list" class="members-list">
                  <!-- Members will be loaded here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="create-group-modal" class="modal" style="display: none;">
      <div class="modal-overlay" id="create-group-modal-overlay"></div>
      <div class="modal-content">
        <button class="modal-close-btn">√ó</button>
        <h2>T·∫°o nh√≥m m·ªõi</h2>
        <form id="create-group-form">
          <div class="form-group">
            <label>T√™n nh√≥m</label>
            <input type="text" id="group-name-input" required placeholder="Nh·∫≠p t√™n nh√≥m">
          </div>
          <div class="form-group">
            <label>M√¥ t·∫£</label>
            <input type="text" id="group-desc-input" placeholder="M√¥ t·∫£ nh√≥m (t√πy ch·ªçn)">
          </div>
          <div class="form-group">
            <label>T√¨m ki·∫øm th√†nh vi√™n</label>
            <input type="text" id="search-member-input" placeholder="T√¨m ki·∫øm theo t√™n ho·∫∑c username...">
            <div id="search-results-list" class="search-results-list"></div>
          </div>
          <div class="form-group">
            <label>Th√†nh vi√™n ƒë√£ ch·ªçn</label>
            <div id="selected-members-list" class="selected-members-list"></div>
          </div>
          <textarea id="group-members-input" style="display: none;" required></textarea>
          <button type="submit" class="btn btn-primary">T·∫°o nh√≥m</button>
        </form>
      </div>
    </div>

    <div id="edit-group-modal" class="modal" style="display: none;">
      <div class="modal-overlay" id="edit-group-modal-overlay"></div>
      <div class="modal-content">
        <button class="modal-close-btn">√ó</button>
        <h2>S·ª≠a th√¥ng tin nh√≥m</h2>
        <form id="edit-group-form">
          <div class="form-group">
            <label>Avatar nh√≥m</label>
            <div class="avatar-upload-wrapper">
              <div class="avatar-preview" id="edit-group-avatar-preview" style="width: 80px; height: 80px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 32px; cursor: pointer; overflow: hidden;">
                A
              </div>
              <input type="file" id="edit-group-avatar-input" accept="image/*" style="display: none;">
              <p style="font-size: 12px; color: #666; margin-top: 8px;">Click avatar ƒë·ªÉ ƒë·ªïi ·∫£nh</p>
            </div>
          </div>
          <div class="form-group">
            <label>T√™n nh√≥m</label>
            <input type="text" id="edit-group-name-input" required placeholder="Nh·∫≠p t√™n nh√≥m">
          </div>
          <div class="form-group">
            <label>M√¥ t·∫£</label>
            <input type="text" id="edit-group-desc-input" placeholder="M√¥ t·∫£ nh√≥m (t√πy ch·ªçn)">
          </div>
          <button type="submit" class="btn btn-primary">L∆∞u thay ƒë·ªïi</button>
        </form>
      </div>
    </div>

    <!-- Add Member Modal -->
    <div id="add-member-modal" class="modal" style="display: none;">
      <div class="modal-overlay" id="add-member-modal-overlay"></div>
      <div class="modal-content">
        <button class="modal-close-btn">√ó</button>
        <h2>Th√™m th√†nh vi√™n</h2>
        <form id="add-member-form">
          <div class="form-group">
            <label>T√¨m ki·∫øm th√†nh vi√™n</label>
            <input type="text" id="add-member-search-input" placeholder="T√¨m ki·∫øm theo t√™n ho·∫∑c username...">
            <div id="add-member-search-results" class="search-results-list"></div>
          </div>
          <div class="form-group">
            <label>Th√†nh vi√™n ƒë∆∞·ª£c ch·ªçn</label>
            <div id="add-member-selected-list" class="selected-members-list"></div>
          </div>
          <textarea id="add-member-ids-input" style="display: none;"></textarea>
          <button type="submit" class="btn btn-primary">Th√™m th√†nh vi√™n</button>
        </form>
      </div>
    </div>

    <!-- Change Role Modal -->
    <div id="change-role-modal" class="modal" style="display: none;">
      <div class="modal-overlay" id="change-role-modal-overlay"></div>
      <div class="modal-content">
        <button class="modal-close-btn">√ó</button>
        <h2>Thay ƒë·ªïi quy·ªÅn th√†nh vi√™n</h2>
        <div id="change-role-list" class="change-role-list">
          <!-- Members will be listed here with role selection -->
        </div>
      </div>
    </div>

    <div id="profile-modal" class="profile-modal" aria-hidden="true">
      <div class="profile-modal-overlay" id="profile-modal-overlay"></div>
      <div class="profile-modal-content" role="dialog" aria-modal="true">
      <button class="modal-close-btn" id="profile-modal-close" aria-label="ƒê√≥ng">√ó</button>
      <div class="profile-avatar-wrapper">
        <div class="profile-modal-avatar" id="profile-modal-avatar">?</div>
        <button type="button" id="avatar-upload-btn" class="avatar-upload-btn" aria-label="ƒê·ªïi ·∫£nh ƒë·∫°i di·ªán">
          <span class="avatar-upload-icon">üì∑</span>
        </button>
        <input type="file" id="avatar-file-input" accept="image/*" hidden>
      </div>
      <p id="avatar-upload-status" class="avatar-upload-status" aria-live="polite"></p>
        <h2 id="profile-modal-name">T√™n ng∆∞·ªùi d√πng</h2>
        <p id="profile-modal-username" class="profile-modal-username">@username</p>
        <p id="profile-modal-email" class="profile-modal-email">email@example.com</p>
        <div class="profile-modal-divider"></div>
        <ul class="profile-modal-info">
          <li><span>H·ªç t√™n:</span><strong id="profile-modal-fullname">-</strong></li>
          <li><span>T√™n ƒëƒÉng nh·∫≠p:</span><strong id="profile-modal-username-detail">-</strong></li>
          <li><span>Email:</span><strong id="profile-modal-email-detail">-</strong></li>
        </ul>
        <form id="profile-edit-form" class="profile-edit-form">
          <div class="form-group">
            <label for="profile-edit-fullname">H·ªç t√™n</label>
            <input type="text" id="profile-edit-fullname" required placeholder="Nh·∫≠p h·ªç t√™n">
          </div>
          <div class="form-group">
            <label for="profile-edit-username">T√™n ƒëƒÉng nh·∫≠p</label>
            <input type="text" id="profile-edit-username" required placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p">
          </div>
          <div class="form-group">
            <label for="profile-edit-email">Email</label>
            <input type="email" id="profile-edit-email" required placeholder="Nh·∫≠p email">
          </div>
          <div class="profile-edit-actions">
            <button type="submit" id="profile-save-btn" class="btn btn-primary">L∆∞u thay ƒë·ªïi</button>
          </div>
          <p id="profile-update-message" class="profile-update-message" aria-live="polite"></p>
        </form>
      </div>
    </div>
  </div>

  <script type="module" src="./src/pages/chat/index.js"></script>
  <script type="module" src="./src/pages/chat/group.module.js"></script>
</body>
</html>

